!function(n){function i(e,t){if(this.element=n(e),this.format=r.parseFormat(t.format||this.element.data("date-format")||"mm/dd/yyyy"),this.picker=n(r.template).appendTo("body").on({click:n.proxy(this.click,this),mousedown:n.proxy(this.mousedown,this)}),this.isInput=this.element.is("input"),this.component=!!this.element.is(".date")&&this.element.find(".add-on"),this.isInput?this.element.on({focus:n.proxy(this.show,this),blur:n.proxy(this.hide,this),keyup:n.proxy(this.update,this)}):(this.component||this.element).on("click",n.proxy(this.show,this)),this.minViewMode=t.minViewMode||this.element.data("date-minviewmode")||0,"string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}if(this.viewMode=t.viewMode||this.element.data("date-viewmode")||0,"string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode,this.weekStart=t.weekStart||this.element.data("date-weekstart")||0,this.weekEnd=0===this.weekStart?6:this.weekStart-1,this.fillDow(),this.fillMonths(),this.update(),this.showMode()}i.prototype={constructor:i,show:function(e){this.picker.show(),this.height=(this.component||this.element).outerHeight(),this.place(),n(window).on("resize",n.proxy(this.place,this)),e&&(e.stopPropagation(),e.preventDefault()),this.isInput||n(document).on("mousedown",n.proxy(this.hide,this)),this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide(),n(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||n(document).off("mousedown",this.hide),this.set(),this.element.trigger({type:"hide",date:this.date})},set:function(){var e=r.formatDate(this.date,this.format);this.isInput?this.element.prop("value",e):(this.component&&this.element.find("input").prop("value",e),this.element.data("date",e))},setValue:function(e){this.date="string"==typeof e?r.parseDate(e,this.format):new Date(e),this.set(),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},place:function(){var e=(this.component||this.element).offset();this.picker.css({top:e.top+this.height,left:e.left})},update:function(e){this.date=r.parseDate("string"==typeof e?e:this.isInput?this.element.prop("value"):this.element.data("date"),this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},fillDow:function(){for(var e=this.weekStart,t="<tr>";e<this.weekStart+7;)t+='<th class="dow">'+r.dates.daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=0;t<12;)e+='<span class="month">'+r.dates.monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").append(e)},fill:function(){var e,t=new Date(this.viewDate),s=t.getFullYear(),a=t.getMonth(),i=this.date.valueOf(),n=(this.picker.find(".datepicker-days th:eq(1)").text(r.dates.months[a]+" "+s),new Date(s,a-1,28,0,0,0,0)),t=r.getDaysInMonth(n.getFullYear(),n.getMonth()),h=(n.setDate(t),n.setDate(t-(n.getDay()-this.weekStart+7)%7),new Date(n));for(h.setDate(h.getDate()+42),h=h.valueOf(),html=[];n.valueOf()<h;)n.getDay()===this.weekStart&&html.push("<tr>"),e="",n.getMonth()<a?e+=" old":n.getMonth()>a&&(e+=" new"),n.valueOf()===i&&(e+=" active"),html.push('<td class="day'+e+'">'+n.getDate()+"</td>"),n.getDay()===this.weekEnd&&html.push("</tr>"),n.setDate(n.getDate()+1);this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var o=this.date.getFullYear(),t=this.picker.find(".datepicker-months").find("th:eq(1)").text(s).end().find("span").removeClass("active"),t=(o===s&&t.eq(this.date.getMonth()).addClass("active"),html="",s=10*parseInt(s/10,10),this.picker.find(".datepicker-years").find("th:eq(1)").text(s+"-"+(s+9)).end().find("td"));--s;for(var d=-1;d<11;d++)html+='<span class="year'+(-1===d||10===d?" old":"")+(o===s?" active":"")+'">'+s+"</span>",s+=1;t.html(html)},click:function(e){e.stopPropagation(),e.preventDefault();var t,s,a,i=n(e.target).closest("span, td, th");if(1===i.length)switch(i[0].nodeName.toLowerCase()){case"th":switch(i[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+r.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+r.modes[this.viewMode].navFnc].call(this.viewDate)+r.modes[this.viewMode].navStep*("prev"===i[0].className?-1:1)),this.fill(),this.set()}break;case"span":i.is(".month")?(s=i.parent().find("span").index(i),this.viewDate.setMonth(s)):(a=parseInt(i.text(),10)||0,this.viewDate.setFullYear(a)),0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:r.modes[this.viewMode].clsName})),this.showMode(-1),this.fill(),this.set();break;case"td":i.is(".day")&&(t=parseInt(i.text(),10)||1,s=this.viewDate.getMonth(),i.is(".old")?--s:i.is(".new")&&(s+=1),a=this.viewDate.getFullYear(),this.date=new Date(a,s,t,0,0,0,0),this.viewDate=new Date(a,s,Math.min(28,t),0,0,0,0),this.fill(),this.set(),this.element.trigger({type:"changeDate",date:this.date,viewMode:r.modes[this.viewMode].clsName}))}},mousedown:function(e){e.stopPropagation(),e.preventDefault()},showMode:function(e){e&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(">div").hide().filter(".datepicker-"+r.modes[this.viewMode].clsName).show()}},n.fn.datepicker=function(s,a){return this.each(function(){var e=n(this),t=e.data("datepicker");t||e.data("datepicker",t=new i(this,n.extend({},n.fn.datepicker.defaults,"object"==typeof s&&s))),"string"==typeof s&&t[s](a)})},n.fn.datepicker.defaults={},n.fn.datepicker.Constructor=i;var r={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},getDaysInMonth:function(e,t){return[31,r.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),e=e.split(/\W+/);if(t&&e&&0!==e.length)return{separator:t,parts:e};throw new Error("Invalid date format.")},parseDate:function(e,t){var s,a=e.split(t.separator);if((e=new Date).setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),a.length===t.parts.length)for(var i=0,n=t.parts.length;i<n;i++)switch(s=parseInt(a[i],10)||1,t.parts[i]){case"dd":case"d":e.setDate(s);break;case"mm":case"m":e.setMonth(s-1);break;case"yy":e.setFullYear(2e3+s);break;case"yyyy":e.setFullYear(s)}return e},formatDate:function(e,t){for(var s={d:e.getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()},e=(s.dd=(s.d<10?"0":"")+s.d,s.mm=(s.m<10?"0":"")+s.m,[]),a=0,i=t.parts.length;a<i;a++)e.push(s[t.parts[a]]);return e.join(t.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};r.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+r.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+r.headTemplate+r.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+r.headTemplate+r.contTemplate+"</table></div></div>"}(window.jQuery);