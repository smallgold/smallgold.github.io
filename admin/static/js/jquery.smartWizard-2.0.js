!function(y){y.fn.smartWizard=function(S){var x=y.extend({},y.fn.smartWizard.defaults,S),g=arguments;return this.each(function(){var s,e,i,a,n,r,t,l=y(this),o=x.selected,d=y("ul > li > a[href^='#step-']",l),h=0,f=y(".actionBar",l);if(0==f.length&&(f=y("<div></div>").addClass("actionBar")),0==(e=y(".msgBox",l)).length&&(e=y('<div class="msgBox"><div class="content"></div><a href="#" class="close">X</a></div>'),f.append(e)),y(".close",e).click(function(){return e.fadeOut("normal"),!1}),S&&"init"!==S&&"object"!=typeof S){if("showMessage"===S)return t=Array.prototype.slice.call(g,1),c=t[0],y(".content",e).html(c),e.show(),!0;{if("setError"===S)return m((t=Array.prototype.slice.call(g,1))[0].stepnum,t[0].iserror),!0;y.error("Method "+S+" does not exist")}}else{var c=l.children("div");l.children("ul").addClass("anchor"),c.addClass("content"),s=y("<div>Loading</div>").addClass("loader"),f=y("<div></div>").addClass("actionBar"),i=y("<div></div>").addClass("stepContainer"),a=y("<a>"+x.labelNext+"</a>").attr("href","#").addClass("buttonNext"),n=y("<a>"+x.labelPrevious+"</a>").attr("href","#").addClass("buttonPrevious"),r=y("<a>"+x.labelFinish+"</a>").attr("href","#").addClass("buttonFinish"),x.errorSteps&&0<x.errorSteps.length&&y.each(x.errorSteps,function(e,t){m(t,!0)}),i.append(c),f.append(s),l.append(i),l.append(f),x.includeFinishButton&&f.append(r),f.append(a).append(n),h=i.width(),y(a).click(function(){return y(this).hasClass("buttonDisabled")||b(),!1}),y(n).click(function(){return y(this).hasClass("buttonDisabled")||C(),!1}),y(r).click(function(){if(!y(this).hasClass("buttonDisabled"))if(y.isFunction(x.onFinish)){if(!x.onFinish.call(this,y(d)));}else{var e=l.parents("form");e&&e.length&&e.submit()}return!1}),y(d).bind("click",function(e){var t;return d.index(this)!=o&&(t=d.index(this),1==+d.eq(t).attr("isDone"))&&u(t),!1}),x.keyNavigation&&y(document).keyup(function(e){39==e.which?b():37==e.which&&C()}),x.enableAllSteps?(y(d,l).removeClass("selected").removeClass("disabled").addClass("done"),y(d,l).attr("isDone",1)):(y(d,l).removeClass("selected").removeClass("done").addClass("disabled"),y(d,l).attr("isDone",0)),y(d,l).each(function(e){y(y(this).attr("href"),l).hide(),y(this).attr("rel",e+1)}),u(o)}function u(t){var a=d.eq(t),e=x.contentURL,n=a.data("hasContent");stepNum=t+1,!(e&&0<e.length)||x.contentCache&&n?p(t):y.ajax({url:e,type:"POST",data:{step_number:stepNum},dataType:"text",beforeSend:function(){s.show()},error:function(){s.hide()},success:function(e){s.hide(),e&&0<e.length&&(a.data("hasContent",!0),y(y(a,l).attr("href"),l).html(e),p(t))}})}function p(t){var e,a=d.eq(t),n=d.eq(o);t!=o&&y.isFunction(x.onLeaveStep)&&!x.onLeaveStep.call(this,y(n))||(x.updateHeight&&i.height(y(y(a,l).attr("href"),l).outerHeight()),"slide"==x.transitionEffect?y(y(n,l).attr("href"),l).slideUp("fast",function(e){y(y(a,l).attr("href"),l).slideDown("fast"),o=t,v(n,a)}):"fade"==x.transitionEffect?y(y(n,l).attr("href"),l).fadeOut("fast",function(e){y(y(a,l).attr("href"),l).fadeIn("fast"),o=t,v(n,a)}):"slideleft"==x.transitionEffect?(e=0,e=o<t?(nextElmLeft1=h+10,(nextElmLeft2=0)-y(y(n,l).attr("href"),l).outerWidth()):(nextElmLeft1=0-y(y(a,l).attr("href"),l).outerWidth()+20,nextElmLeft2=0,10+y(y(n,l).attr("href"),l).outerWidth()),t==o?(nextElmLeft1=y(y(a,l).attr("href"),l).outerWidth()+20,e=(nextElmLeft2=0)-y(y(n,l).attr("href"),l).outerWidth()):y(y(n,l).attr("href"),l).animate({left:e},"fast",function(e){y(y(n,l).attr("href"),l).hide()}),y(y(a,l).attr("href"),l).css("left",nextElmLeft1),y(y(a,l).attr("href"),l).show(),y(y(a,l).attr("href"),l).animate({left:nextElmLeft2},"fast",function(e){o=t,v(n,a)})):(y(y(n,l).attr("href"),l).hide(),y(y(a,l).attr("href"),l).show(),o=t,v(n,a)))}function v(e,t){y(e,l).removeClass("selected"),y(e,l).addClass("done"),y(t,l).removeClass("disabled"),y(t,l).removeClass("done"),y(t,l).addClass("selected"),y(t,l).attr("isDone",1),x.cycleSteps||(o<=0?y(n).addClass("buttonDisabled"):y(n).removeClass("buttonDisabled"),d.length-1<=o?y(a).addClass("buttonDisabled"):y(a).removeClass("buttonDisabled")),!d.hasClass("disabled")||x.enableFinishButton?y(r).removeClass("buttonDisabled"):y(r).addClass("buttonDisabled"),y.isFunction(x.onShowStep)&&x.onShowStep.call(this,y(t))}function b(){var e=o+1;if(d.length<=e){if(!x.cycleSteps)return;e=0}u(e)}function C(){var e=o-1;if(e<0){if(!x.cycleSteps)return;e=d.length-1}u(e)}function m(e,t){t?y(d.eq(e-1),l).addClass("error"):y(d.eq(e-1),l).removeClass("error")}})},y.fn.smartWizard.defaults={selected:0,keyNavigation:!0,enableAllSteps:!1,updateHeight:!0,transitionEffect:"fade",contentURL:null,contentCache:!0,cycleSteps:!1,includeFinishButton:!0,enableFinishButton:!1,errorSteps:[],labelNext:"Next",labelPrevious:"Previous",labelFinish:"Finish",onLeaveStep:null,onShowStep:null,onFinish:null}}(jQuery);