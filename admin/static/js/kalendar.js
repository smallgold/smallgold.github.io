!function(c,e,r){var a={startMonth:(new Date).getMonth(),startYear:(new Date).getFullYear(),firstDayOfWeek:"Monday",events:[],color:"red",showdays:!0,tracking:!0,template:'<div class="c-month-view"><div class="c-month-arrow-left"><i class="fa fa-angle-left"></i> </div><p></p><div class="c-month-arrow-right"><i class="fa fa-angle-right"></i> </div></div><div class="c-holder"><div class="c-grid"></div><div class="c-specific"><div class="specific-day"><div class="specific-day-info" i="date"></div><div class="specific-day-info" i="day"></div></div><div class="s-scheme"></div></div></div>',calendar_elements:{monthShow:".c-month-view p",prevMonth:".c-month-arrow-left",nextMonth:".c-month-arrow-right",grid:".c-grid",specday_trigger:".specific-day",specday_day:".specific-day-info[i=day]",specday_date:".specific-day-info[i=date]",specday_scheme:".s-scheme"},monthHuman:[["JAN","January"],["FEB","February"],["MAR","March"],["APR","April"],["MAY","May"],["JUN","June"],["JUL","July"],["AUG","August"],["SEP","September"],["OCT","October"],["NOV","November"],["DEC","December"]],dayHuman:[["S","Sunday"],["M","Monday"],["T","Thursday"],["W","Wednesday"],["T","Thursday"],["F","Friday"],["S","Saturday"]],dayMachine:function(t){var e=[];return e.Sunday=0,e.Monday=1,e.Tuesday=2,e.Wednesday=3,e.Thursday=4,e.Friday=5,e.Saturday=6,e[t]},urlText:"View on Web",onInitiated:function(){console.log("initiated")},onGoogleParsed:function(){console.log("googleparsed")},onMonthChanged:function(){console.log("monthshow")},onDayShow:function(){console.log("dayshow")},onGridShow:function(){console.log("gridshow")},onDayClick:function(t){console.log(t.data.info)}};function s(t,e){this.options=c.extend(!0,{},a,e),this.element=t,this.currentMonth=this.options.startMonth,this.currentYear=this.options.startYear,this.currentTimeSet=new Date(this.options.startYear,this.options.startMonth),this.firstDayOfWeek=[this.options.dayMachine(this.options.firstDayOfWeek),this.options.firstDayOfWeek],this.currentTime=new Date,this.currentTime.setHours(0,0,0,0),this.options.tracking&&this.tracking(),this.googleCal()}function o(t,e){function a(t,e,a){a=a||e.start.date,e={title:e.title,url:e.url,start:{date:e.start.date,time:e.start.time,d:e.start.d},end:{date:e.end.date,time:e.end.time,d:e.end.d},location:e.location,allDay:e.allDay,color:e.color},t[a]||(t[a]=[]),t[a].push(e)}if(e.start.date=parseInt(e.start.date),e.end.date=parseInt(e.end.date),e.start.date>e.end.date)console.warn("The party was over before it started. Thatâ€™s just an expression.",e);else if("number"!=typeof e.start.date||"number"!=typeof e.end.date||isNaN(e.end.date)||isNaN(e.start.date))console.warn("There is something wrong with this event, so it was skipped. Take a look at it",e);else if(e.start.date==e.end.date)a(t,e);else for(var n=h(e.start.date,"YYYYMMDD"),s=(h(e.end.date,"YYYYMMDD").getTime()-n.getTime())/864e5,i=0;i<=s;i++){var o=c.extend(!0,{},e),r=l(new Date(n.getTime()+864e5*i),"YYYYMMDD");0==i||i!=s&&(o.allDay=!0),a(t,o,r)}return t}function l(t,e){function a(t){return t<10?"0"+t:t}return"YYYYMMDD"==e?t.getFullYear()+""+a(t.getMonth()+1)+a(t.getDate()):"HH.MM"==e?a(t.getHours()+1)+"."+a(t.getMinutes()+1):void 0}function h(t,e){return"YYYYMMDD"==e?(t=t.toString(),(d=new Date).setYear(t.substring(0,4)),d.setMonth(t.substring(4,6)-1),d.setDate(t.substring(6,8))):"YYYYMMDDHHMM"==e&&(d=new Date,st=t[0].toString(),d.setYear(st.substring(0,4)),d.setMonth(st.substring(4,6)-1),d.setDate(st.substring(6,8)),st=(st=t[1].toString()).split(".")[0].length<2?"0"+st:st,d.setHours(st.substring(0,2)),d.setMinutes(st.substring(3,5)),d.setSeconds(0)),d}s.prototype.tracking=function(){$trackimg=c('<img src="">'),this.trackimg=$trackimg,this.element.append(this.trackimg);var t={url:e.location.href,color:this.options.color,showdays:this.options.showdays,firstdayofweek:this.options.firstDayOfWeek},a="http://www.ericwenn.se/php/trackingkalendar.php",n=0;c.each(t,function(t,e){a+=(0==n?"?":"&")+t+"="+encodeURIComponent(e),n++}),this.trackimg.attr("src",a)},s.prototype.googleCal=function(){function t(t,e){c.getJSON("https://www.googleapis.com/calendar/v3/calendars/"+t+"/events?key="+e,function(t){for(var e=0;e<t.items.length;e++){var a=t.items[e],n=new Date(a.start.dateTime),s=new Date(a.end.dateTime),n={title:a.summary,location:a.location,start:{date:l(n,"YYYYMMDD"),time:l(n,"HH.MM"),d:new Date(a.start.dateTime)},end:{date:l(s,"YYYYMMDD"),time:l(s,"HH.MM"),d:new Date(a.end.dateTime)}};i=o(i,n)}})}var i=this.options.eventsParsed;if(this.options.googleCal)if(this.options.googleCal instanceof Array)for(var e=0;e<this.options.googleCal.length;e++)t(this.options.googleCal[e].calendar,this.options.googleCal[e].apikey);else t(this.options.googleCal.calendar,this.options.googleCal.apikey);this.options.eventsParsed=i,this.init(),this.options.googleCal&&this.options.onGoogleParsed()},s.prototype.init=function(){for(var t in this.element.html(this.options.template),this.element.attr("ewcalendar",""),this.element.attr("color",this.options.color),this.elements={},this.options.calendar_elements)this.elements[t]=this.element.find(this.options.calendar_elements[t]);this.setMonth(),this.elements.prevMonth.on("click",{self:this,dir:"prev"},this.changeMonth),this.elements.nextMonth.on("click",{self:this,dir:"next"},this.changeMonth),this.options.onInitiated()},s.prototype.changeMonth=function(t){var e=t.data.self,t=t.data.dir;e.currentMonth+="prev"==t?-1:1,e.currentTimeSet=new Date(e.currentYear,e.currentMonth),e.currentMonth=e.currentTimeSet.getMonth(),e.currentYear=e.currentTimeSet.getFullYear(),e.setMonth()},s.prototype.setMonth=function(){var t=this.elements.grid;if(t.html(""),this.elements.monthShow.html(this.options.monthHuman[this.currentTimeSet.getMonth()][1]+" "+this.currentTimeSet.getFullYear()),this.options.showdays){$dayView=c('<div class="c-row"></div>');for(var e=0;e<7;e++){var a=this.firstDayOfWeek[0]+e;a-=6<a?7:0,$dayView.append('<div class="c-day c-l"><div class="date-holder">'+this.options.dayHuman[a][0]+"</div></div>")}t.append($dayView)}var n=new Date(this.currentTimeSet),s=n.getDay()-this.firstDayOfWeek[0];s+=s<1?7:0,n.setDate(n.getDate()-s);for(e=0;e<42;e++){0!=e&&e%7!=0||($row=c('<div class="c-row"></div>'),t.append($row)),$day=c('<div class="c-day"><div class="date-holder">'+n.getDate()+"</div></div>"),n.getMonth()!==this.currentTimeSet.getMonth()?($day.addClass("other-month"),$day.on("click",{info:"other-month"},this.options.onDayClick)):n.getTime()==this.currentTime.getTime()?($day.addClass("this-day"),$day.on("click",{info:"this-day"},this.options.onDayClick)):$day.on("click",{info:"this-month"},this.options.onDayClick);var i=l(n,"YYYYMMDD");if(this.options.eventsParsed[i]!==r){$day.addClass("have-events"),$eventholder=c('<div class="event-n-holder"></div>');for(var o=0;o<3&&o<this.options.eventsParsed[i].length;o++)$eventholder.append('<div class="event-n"></div>');$day.on("click",{day:this.options.eventsParsed[i],self:this,date:n.getTime(),strtime:i},this.showDay),$day.append($eventholder)}$row.append($day),n.setDate(n.getDate()+1)}this.options.onMonthChanged()},s.prototype.showDay=function(t){var e=t.data.day,a=t.data.self,n=new Date(t.data.date),s=t.data.strtime;a.element.addClass("spec-day"),a.elements.specday_day.html(a.options.dayHuman[n.getDay()][1]),a.elements.specday_date.html(n.getDate()),a.elements.specday_trigger.on("click",{self:a},a.hideDay);for(var i=0;i<e.length;i++){var o="",r="",d="",l="",h=((ev=e[i]).color&&(h=a.options.eventcolors[ev.color])&&(o=h.text?'style="color:'+h.text+'"':"",r=h.text?'style="color:'+h.text+';opacity:0.5"':"",d=h.link?'style="color:'+h.link+'"':"",l=h.background?'style="background-color:'+h.background+'"':""),($event=c('<div class="s-event" '+l+"></div>")).append("<h5 "+o+">"+e[i].title+"</h5>"),{date:ev.start.date==s?"":ev.start.d.getDate(),month:ev.start.date==s?"":a.options.monthHuman[ev.start.d.getMonth()][1],year:ev.start.d.getFullYear()==a.currentYear?"":ev.start.d.getFullYear()}),l={date:ev.end.date==s?"":ev.end.d.getDate(),month:ev.end.date==s?"":a.options.monthHuman[ev.end.d.getMonth()][1],year:ev.end.d.getFullYear()==a.currentYear?"":ev.end.d.getFullYear()},h=h.date+" "+h.month+" "+h.year+" "+ev.start.time,l=l.date+" "+l.month+" "+l.year+" "+ev.end.time;$event.append("<p "+r+">"+h+" - "+l+"</p>"),e[i].location&&$event.append("<p "+r+">"+e[i].location+"</p>"),e[i].url&&$event.append("<p><a "+d+' href="'+e[i].url+'">'+a.options.urlText+"</a></p>"),a.elements.specday_scheme.append($event)}a.options.onDayShow()},s.prototype.hideDay=function(t){t=t.data.self;t.element.removeClass("spec-day"),t.elements.specday_scheme.html(""),t.options.onGridShow()},c.fn.kalendar=function(n){return this.each(function(){if(n.events!==r){n.eventsParsed=[];for(var t=0;t<n.events.length;t++){var e=n.events[t];e.end.date=(e.end.date==r?e.start:e.end).date,e.start.d=h([e.start.date,e.start.time],"YYYYMMDDHHMM"),e.end.d=h([e.end.date,e.end.time],"YYYYMMDDHHMM"),n.eventsParsed=o(n.eventsParsed,e)}}n.source="JS";var a=new s(c(this),n);c(this).data("kalendar-instance",a)})}}(jQuery,window,void document);