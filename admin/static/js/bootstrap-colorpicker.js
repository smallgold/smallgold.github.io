!function(r){function e(t){this.value={h:1,s:1,b:1,a:1},this.setColor(t)}function s(t,e){this.element=r(t),t=e.format||this.element.data("color-format")||"hex",this.format=n.translateFormats[t],this.isInput=this.element.is("input"),this.component=!!this.element.is(".color")&&this.element.find(".add-on"),this.picker=r(n.template).appendTo("body").on("mousedown",r.proxy(this.mousedown,this)),this.isInput?this.element.on({focus:r.proxy(this.show,this),keyup:r.proxy(this.update,this)}):(this.component||this.element).on({click:r.proxy(this.show,this)}),"rgba"!==t&&"hsla"!==t||(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update()}e.prototype={constructor:e,setColor:function(s){s=s.toLowerCase();var i=this;r.each(n.stringParsers,function(t,e){var o=e.re.exec(s),o=o&&e.parse(o),e=e.space||"rgba";if(o)return i.value="hsla"===e?n.RGBtoHSB.apply(null,n.HSLtoRGB.apply(null,o)):n.RGBtoHSB.apply(null,o),!1})},setHue:function(t){this.value.h=1-t},setSaturation:function(t){this.value.s=t},setLightness:function(t){this.value.b=1-t},setAlpha:function(t){this.value.a=parseInt(100*(1-t),10)/100},toRGB:function(t,e,o,s){var i,r,n;return t||(t=this.value.h,e=this.value.s,o=this.value.b),t=(t*=360)%360/60,i=r=e=o-(o=o*e),i+=[o,n=o*(1-Math.abs(t%2-1)),0,0,n,o][t=~~t],r+=[n,o,o,n,0,0][t],e+=[0,0,n,o,o,n][t],{r:Math.round(255*i),g:Math.round(255*r),b:Math.round(255*e),a:s||this.value.a}},toHex:function(t,e,o,s){t=this.toRGB(t,e,o,s);return"#"+(1<<24|parseInt(t.r)<<16|parseInt(t.g)<<8|parseInt(t.b)).toString(16).substr(1)},toHSL:function(t,e,o,s){t||(t=this.value.h,e=this.value.s,o=this.value.b);var i=(2-e)*o,e=e*o;return{h:t,s:e=1<(e/=0<i&&i<=1?i:2-i)?1:e,l:i/=2,a:s||this.value.a}}};s.prototype={constructor:s,show:function(t){this.picker.show(),this.height=(this.component||this.element).outerHeight(),this.place(),r(window).on("resize",r.proxy(this.place,this)),this.isInput||t&&(t.stopPropagation(),t.preventDefault()),r(document).on({mousedown:r.proxy(this.hide,this)}),this.element.trigger({type:"show",color:this.color})},update:function(){this.color=new e(this.isInput?this.element.prop("value"):this.element.data("color")),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},setValue:function(t){this.color=new e(t),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color})},hide:function(){this.picker.hide(),r(window).off("resize",this.place),this.isInput?this.element.prop("value",this.format.call(this)):(r(document).off({mousedown:this.hide}),this.component&&this.element.find("input").prop("value",this.format.call(this)),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hide",color:this.color})},place:function(){var t=(this.component||this.element).offset();this.picker.css({top:t.top+this.height,left:t.left})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(t){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(t){t.stopPropagation(),t.preventDefault();var e=r(t.target).closest("div");if(!e.is(".colorpicker")){if(e.is(".colorpicker-saturation"))this.slider=r.extend({},n.sliders.saturation);else if(e.is(".colorpicker-hue"))this.slider=r.extend({},n.sliders.hue);else{if(!e.is(".colorpicker-alpha"))return!1;this.slider=r.extend({},n.sliders.alpha)}var o=e.offset();this.slider.knob=e.find("i")[0].style,this.slider.left=t.pageX-o.left,this.slider.top=t.pageY-o.top,this.pointer={left:t.pageX,top:t.pageY},r(document).on({mousemove:r.proxy(this.mousemove,this),mouseup:r.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(t){t.stopPropagation(),t.preventDefault();var e=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((t.pageX||this.pointer.left)-this.pointer.left))),t=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((t.pageY||this.pointer.top)-this.pointer.top)));return this.slider.knob.left=e+"px",this.slider.knob.top=t+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,e/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,t/100),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),r(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},r.fn.colorpicker=function(o){return this.each(function(){var t=r(this),e=t.data("colorpicker");e||t.data("colorpicker",e=new s(this,r.extend({},r.fn.colorpicker.defaults,"object"==typeof o&&o))),"string"==typeof o&&e[o]()})},r.fn.colorpicker.defaults={},r.fn.colorpicker.Constructor=s;var n={translateFormats:{rgb:function(){var t=this.color.toRGB();return"rgb("+t.r+","+t.g+","+t.b+")"},rgba:function(){var t=this.color.toRGB();return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},hsl:function(){var t=this.color.toHSL();return"hsl("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%)"},hsla:function(){var t=this.color.toHSL();return"hsla("+Math.round(360*t.h)+","+Math.round(100*t.s)+"%,"+Math.round(100*t.l)+"%,"+t.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(t,e,o,s){var i,r;return t/=255,e/=255,o/=255,{h:((0==(r=(i=Math.max(t,e,o))-Math.min(t,e,o))?null:i==t?(e-o)/r:i==e?(o-t)/r+2:(t-e)/r+4)+360)%6*60/360||1,s:0==r?0:r/i,b:i,a:s||1}},HueToRGB:function(t,e,o){return o<0?o+=1:1<o&&--o,6*o<1?t+(e-t)*o*6:2*o<1?e:3*o<2?t+(e-t)*(2/3-o)*6:t},HSLtoRGB:function(t,e,o,s){e<0&&(e=0);var e=2*o-(o=o<=.5?o*(1+e):o+e-o*e),i=t,r=t-1/3;return[Math.round(255*n.HueToRGB(e,o,t+1/3)),Math.round(255*n.HueToRGB(e,o,i)),Math.round(255*n.HueToRGB(e,o,r)),s||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1]/360,t[2]/100,t[3]/100,t[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery);