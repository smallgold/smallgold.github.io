!function(a){"use strict";var s={},l=Math.max,r=Math.min;s.c={},s.c.d=a(document),s.c.t=function(t){return t.originalEvent.touches.length-1},s.o=function(){var h=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.run=function(){function t(t,i){for(var s in i)h.o[s]=i[s];h.init(),h._configure()._draw()}if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=a.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly"),cursor:(!0===this.$.data("cursor")?30:this.$.data("cursor"))||0,thickness:this.$.data("thickness")||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",inline:!1,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null,error:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(i){var s=a(this);h.i[i]=s,h.v[i]=s.val(),s.bind("change",function(){var t={};t[i]=s.val(),h.val(t)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){h.val(h._validate(h.$.val()))})),this.o.displayInput||this.$.hide(),this.$c=a('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"></canvas>'),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,this.c?(this.$.wrap(a('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c),this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.o.width),this.$c.height(this.o.height)),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this):void(this.o.error&&this.o.error())},this._draw=function(){var t=!0,i=document.createElement("canvas");i.width=h.o.width*h.scale,i.height=h.o.height*h.scale,h.g=i.getContext("2d"),h.clear(),!1!==(t=h.dH?h.dH():t)&&h.draw(),h.c.drawImage(i,0,0)},this._touch=function(t){function i(t){(t=h.xy2val(t.originalEvent.touches[h.t].pageX,t.originalEvent.touches[h.t].pageY))==h.cv||h.cH&&!1===h.cH(t)||(h.change(h._validate(t)),h._draw())}return this.t=s.c.t(t),i(t),s.c.d.bind("touchmove.k",i).bind("touchend.k",function(){s.c.d.unbind("touchmove.k touchend.k"),h.rH&&!1===h.rH(h.cv)||h.val(h.cv)}),this},this._mouse=function(t){function i(t){(t=h.xy2val(t.pageX,t.pageY))==h.cv||h.cH&&!1===h.cH(t)||(h.change(h._validate(t)),h._draw())}return i(t),s.c.d.bind("mousemove.k",i).bind("keyup.k",function(t){27===t.keyCode&&(s.c.d.unbind("mouseup.k mousemove.k keyup.k"),h.eH&&!1===h.eH()||h.cancel())}).bind("mouseup.k",function(){s.c.d.unbind("mousemove.k mouseup.k keyup.k"),h.rH&&!1===h.rH(h.cv)||h.val(h.cv)}),this},this._xy=function(){var t=this.$c.offset();return this.x=t.left,this.y=t.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(t){t.preventDefault(),h._xy()._mouse(t)}).bind("touchstart",function(t){t.preventDefault(),h._xy()._touch(t)}),this.listen()),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(t){return~~((t<0?-.5:.5)+t/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(){},this.val=function(){},this.xy2val=function(){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(t,i){return t=t.substring(1,7),"rgba("+(t=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)])[0]+","+t[1]+","+t[2]+","+i+")"},this.copy=function(t,i){for(var s in t)i[s]=t[s]}},s.Dial=function(){s.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=a.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(t){return null==t?this.v:(this.cv=this.o.stopper?l(r(t,this.o.max),this.o.min):t,this.v=this.cv,this.$.val(this.v),void this._draw())},this.xy2val=function(t,i){t=Math.atan2(t-(this.x+this.w2),-(i-this.y-this.w2))-this.angleOffset;return this.angleArc!=this.PI2&&t<0&&-.5<t?t=0:t<0&&(t+=this.PI2),i=~~(.5+t*(this.o.max-this.o.min)/this.angleArc)+this.o.min,i=this.o.stopper?l(r(i,this.o.max),this.o.min):i},this.listen=function(){function t(t){t.preventDefault();var i=(t=t.originalEvent).detail||t.wheelDeltaX,t=t.detail||t.wheelDeltaY,i=parseInt(n.$.val())+(0<i||0<t?n.o.step:i<0||t<0?-n.o.step:0);n.cH&&!1===n.cH(i)||n.val(i)}var s,h,n=this,e=1,o={37:-n.o.step,38:n.o.step,39:n.o.step,40:-n.o.step};this.$.bind("keydown",function(t){var i=t.keyCode;96<=i&&i<=105&&(i=t.keyCode=i-48),s=parseInt(String.fromCharCode(i)),isNaN(s)&&(13!==i&&8!==i&&9!==i&&189!==i&&t.preventDefault(),-1<a.inArray(i,[37,38,39,40]))&&(t.preventDefault(),t=parseInt(n.$.val())+o[i]*e,n.o.stopper&&(t=l(r(t,n.o.max),n.o.min)),n.change(t),n._draw(),h=window.setTimeout(function(){e*=2},30))}).bind("keyup",function(){isNaN(s)?h&&(window.clearTimeout(h),h=null,e=1,n.val(n.$.val())):n.$.val()>n.o.max&&n.$.val(n.o.max)||n.$.val()<n.o.min&&n.$.val(n.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",t),this.$.bind("mousewheel DOMMouseScroll",t)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.o.width/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var t=l(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.o.width/2+4>>0)+"px",height:(this.o.width/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.o.width/3>>0)+"px","margin-left":"-"+(3*this.o.width/4+2>>0)+"px",border:0,background:"none",font:"600 "+(this.o.width/t>>0)+"px 'Source Sans Pro', Arial","text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(t){this.cv=t,this.$.val(t)},this.angle=function(t){return(t-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.draw=function(){var t,i,s=this.g,h=this.angle(this.cv),n=this.startAngle,h=n+h,e=1;s.lineWidth=this.lineWidth,s.lineCap=this.lineCap,this.o.cursor&&(n=h-this.cursorExt)&&(h+=this.cursorExt),s.beginPath(),s.strokeStyle=this.o.bgColor,s.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0),s.stroke(),this.o.displayPrevious&&(i=this.startAngle+this.angle(this.v),t=this.startAngle,this.o.cursor&&(t=i-this.cursorExt)&&(i+=this.cursorExt),s.beginPath(),s.strokeStyle=this.pColor,s.arc(this.xy,this.xy,this.radius,t,i,!1),s.stroke(),e=this.cv==this.v),s.beginPath(),s.strokeStyle=(e?this.o:this).fgColor,s.arc(this.xy,this.xy,this.radius,n,h,!1),s.stroke()},this.cancel=function(){this.val(this.v)}},a.fn.dial=a.fn.knob=function(i){return this.each(function(){var t=new s.Dial;t.o=i,t.$=a(this),t.run()}).parent()}}(jQuery);