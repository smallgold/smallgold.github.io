!function(f){"use strict";function n(e,t){this.options=t,this.$element=f(e),this.$container=f("<div/>",{class:"ms-container"}),this.$selectableContainer=f("<div/>",{class:"ms-selectable"}),this.$selectionContainer=f("<div/>",{class:"ms-selection"}),this.$selectableUl=f("<ul/>",{class:"ms-list",tabindex:"-1"}),this.$selectionUl=f("<ul/>",{class:"ms-list",tabindex:"-1"}),this.scrollTo=0,this.sanitizeRegexp=new RegExp("\\W+","gi"),this.elemsSelector="li:visible:not(.ms-optgroup-label,.ms-optgroup-container,."+t.disabledClass+")"}n.prototype={constructor:n,init:function(){var e=this,t=this.$element,s=(0===t.next(".ms-container").length&&(t.css({position:"absolute",left:"-9999px"}),t.attr("id",t.attr("id")?t.attr("id"):Math.ceil(1e3*Math.random())+"multiselect"),this.$container.attr("id","ms-"+t.attr("id")),t.find("option").each(function(){e.generateLisFromOption(this)}),this.$selectionUl.find(".ms-optgroup-label").hide(),e.options.selectableHeader&&e.$selectableContainer.append(e.options.selectableHeader),e.$selectableContainer.append(e.$selectableUl),e.options.selectableFooter&&e.$selectableContainer.append(e.options.selectableFooter),e.options.selectionHeader&&e.$selectionContainer.append(e.options.selectionHeader),e.$selectionContainer.append(e.$selectionUl),e.options.selectionFooter&&e.$selectionContainer.append(e.options.selectionFooter),e.$container.append(e.$selectableContainer),e.$container.append(e.$selectionContainer),t.after(e.$container),e.activeMouse(e.$selectableUl),e.activeKeyboard(e.$selectableUl),s=e.options.dblClick?"dblclick":"click",e.$selectableUl.on(s,".ms-elem-selectable",function(){e.select(f(this).data("ms-value"))}),e.$selectionUl.on(s,".ms-elem-selection",function(){e.deselect(f(this).data("ms-value"))}),e.activeMouse(e.$selectionUl),e.activeKeyboard(e.$selectionUl),t.on("focus",function(){e.$selectableUl.focus()})),t.find("option:selected").map(function(){return f(this).val()}).get());e.select(s,"init"),"function"==typeof e.options.afterInit&&e.options.afterInit.call(this,this.$container)},generateLisFromOption:function(e){for(var t=this,s=t.$element,l="",i=f(e),n=0;n<e.attributes.length;n++){var o=e.attributes[n];"value"!==o.name&&"disabled"!==o.name&&(l+=o.name+'="'+o.value+'" ')}var a,c=f("<li "+l+"><span>"+i.text()+"</span></li>"),r=c.clone(),d=i.val(),p=t.sanitize(d,t.sanitizeRegexp),h=(c.data("ms-value",d).addClass("ms-elem-selectable").attr("id",p+"-selectable"),r.data("ms-value",d).addClass("ms-elem-selection").attr("id",p+"-selection").hide(),(i.prop("disabled")||s.prop("disabled"))&&(r.addClass(t.options.disabledClass),c.addClass(t.options.disabledClass)),i.parent("optgroup"));(0<h.length?(d=h.attr("label"),p=t.sanitize(d,t.sanitizeRegexp),s=t.$selectableUl.find("#optgroup-selectable-"+p),i=t.$selectionUl.find("#optgroup-selection-"+p),0===s.length&&(d='<ul class="ms-optgroup"><li class="ms-optgroup-label"><span>'+d+"</span></li></ul>",s=f(a='<li class="ms-optgroup-container"></li>'),i=f(a),s.attr("id","optgroup-selectable-"+p),i.attr("id","optgroup-selection-"+p),s.append(f(d)),i.append(f(d)),t.options.selectableOptgroup&&(s.find(".ms-optgroup-label").on("click",function(){var e=h.children(":not(:selected)").map(function(){return f(this).val()}).get();t.select(e)}),i.find(".ms-optgroup-label").on("click",function(){var e=h.children(":selected").map(function(){return f(this).val()}).get();t.deselect(e)})),t.$selectableUl.append(s),t.$selectionUl.append(i)),s.children().append(c),i.children()):(t.$selectableUl.append(c),t.$selectionUl)).append(r)},activeKeyboard:function(t){var s=this;t.on("focus",function(){f(this).addClass("ms-focus")}).on("blur",function(){f(this).removeClass("ms-focus")}).on("keydown",function(e){switch(e.which){case 40:case 38:return e.preventDefault(),e.stopPropagation(),void s.moveHighlight(f(this),38===e.which?-1:1);case 32:return e.preventDefault(),e.stopPropagation(),void s.selectHighlighted(t);case 37:case 39:return e.preventDefault(),e.stopPropagation(),void s.switchList(t)}})},moveHighlight:function(e,t){var s,l,i=e.find(this.elemsSelector),n=i.filter(".ms-hover"),o=null,a=i.first().outerHeight(),c=e.height();this.$container.prop("id");i.off("mouseenter"),i.removeClass("ms-hover"),1===t?0===(o=n.nextAll(this.elemsSelector).first()).length&&(o=((s=n.parent()).hasClass("ms-optgroup")&&0<(l=s.parent().next(":visible")).length?l.find(this.elemsSelector):i).first()):-1===t&&0===(o=n.prevAll(this.elemsSelector).first()).length&&(o=((s=n.parent()).hasClass("ms-optgroup")&&0<(l=s.parent().prev(":visible")).length?l.find(this.elemsSelector):i).last()),0<o.length&&(o.addClass("ms-hover"),t=e.scrollTop()+o.position().top-c/2+a/2,e.scrollTop(t))},selectHighlighted:function(e){var t=e.find(this.elemsSelector),s=t.filter(".ms-hover").first();0<s.length&&(e.parent().hasClass("ms-selectable")?this.select(s.data("ms-value")):this.deselect(s.data("ms-value")),t.removeClass("ms-hover"))},switchList:function(e){e.blur(),(e.parent().hasClass("ms-selectable")?this.$selectionUl:this.$selectableUl).focus()},activeMouse:function(t){var s=this;t.on("mousemove",function(){var e=t.find(s.elemsSelector);e.on("mouseenter",function(){e.removeClass("ms-hover"),f(this).addClass("ms-hover")})})},refresh:function(){this.destroy(),this.$element.multiSelect(this.options)},destroy:function(){f("#ms-"+this.$element.attr("id")).remove(),this.$element.removeData("multiselect")},select:function(e,t){"string"==typeof e&&(e=[e]);var s=this,l=this.$element,i=f.map(e,function(e){return s.sanitize(e,s.sanitizeRegexp)}),n=this.$selectableUl.find("#"+i.join("-selectable, #")+"-selectable").filter(":not(."+s.options.disabledClass+")"),i=this.$selectionUl.find("#"+i.join("-selection, #")+"-selection").filter(":not(."+s.options.disabledClass+")"),o=l.find("option:not(:disabled)").filter(function(){return-1<f.inArray(this.value,e)});0<n.length&&(n.addClass("ms-selected").hide(),i.addClass("ms-selected").show(),o.prop("selected",!0),0<(n=s.$selectableUl.children(".ms-optgroup-container")).length?(n.each(function(){var e=f(this).find(".ms-elem-selectable");e.length===e.filter(".ms-selected").length&&f(this).find(".ms-optgroup-label").hide()}),s.$selectionUl.children(".ms-optgroup-container").each(function(){0<f(this).find(".ms-elem-selection").filter(".ms-selected").length&&f(this).find(".ms-optgroup-label").show()})):s.options.keepOrder&&1<(o=s.$selectionUl.find(".ms-selected")).length&&o.last().get(0)!=i.get(0)&&i.insertAfter(o.last()),"init"!==t)&&(l.trigger("change"),"function"==typeof s.options.afterSelect)&&s.options.afterSelect.call(this,e)},deselect:function(e){"string"==typeof e&&(e=[e]);var t=this,s=this.$element,l=f.map(e,function(e){return t.sanitize(e,t.sanitizeRegexp)}),i=this.$selectableUl.find("#"+l.join("-selectable, #")+"-selectable"),l=this.$selectionUl.find("#"+l.join("-selection, #")+"-selection").filter(".ms-selected"),n=s.find("option").filter(function(){return-1<f.inArray(this.value,e)});0<l.length&&(i.removeClass("ms-selected").show(),l.removeClass("ms-selected").hide(),n.prop("selected",!1),0<(i=t.$selectableUl.children(".ms-optgroup-container")).length&&(i.each(function(){0<f(this).find(".ms-elem-selectable").filter(":not(.ms-selected)").length&&f(this).find(".ms-optgroup-label").show()}),t.$selectionUl.children(".ms-optgroup-container").each(function(){0===f(this).find(".ms-elem-selection").filter(".ms-selected").length&&f(this).find(".ms-optgroup-label").hide()})),s.trigger("change"),"function"==typeof t.options.afterDeselect)&&t.options.afterDeselect.call(this,e)},select_all:function(){var e=this.$element,t=e.val();e.find('option:not(":disabled")').prop("selected",!0),this.$selectableUl.find(".ms-elem-selectable").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").hide(),this.$selectionUl.find(".ms-optgroup-label").show(),this.$selectableUl.find(".ms-optgroup-label").hide(),this.$selectionUl.find(".ms-elem-selection").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").show(),this.$selectionUl.focus(),e.trigger("change"),"function"==typeof this.options.afterSelect&&(e=f.grep(e.val(),function(e){return f.inArray(e,t)<0}),this.options.afterSelect.call(this,e))},deselect_all:function(){var e=this.$element,t=e.val();e.find("option").prop("selected",!1),this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show(),this.$selectionUl.find(".ms-optgroup-label").hide(),this.$selectableUl.find(".ms-optgroup-label").show(),this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide(),this.$selectableUl.focus(),e.trigger("change"),"function"==typeof this.options.afterDeselect&&this.options.afterDeselect.call(this,t)},sanitize:function(e,t){return e.replace(t,"_")}},f.fn.multiSelect=function(){var l=arguments[0],i=arguments;return this.each(function(){var e=f(this),t=e.data("multiselect"),s=f.extend({},f.fn.multiSelect.defaults,e.data(),"object"==typeof l&&l);t||e.data("multiselect",t=new n(this,s)),"string"==typeof l?t[l](i[1]):t.init()})},f.fn.multiSelect.defaults={selectableOptgroup:!1,disabledClass:"disabled",dblClick:!1,keepOrder:!1},f.fn.multiSelect.Constructor=n}(window.jQuery);